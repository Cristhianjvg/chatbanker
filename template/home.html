{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <link type='text/css' href='{% static "css/home.css" %}' rel='stylesheet' />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHATBANKER </title>
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
</head>

<body>
    <img class="background-image" src='{% static "imagenes/imagen4.jpg" %}' alt="Imagen de fondo">
    <section id="pdf-section" class="pdfsec">
        <h2>Subir PDF y Visualizar</h2>
        <form action="/pdf" method="POST" enctype="multipart/form-data">
            <input type="file" name="archivos[]" multiple>
            <button type="submit">Subir</button>
        </form>
    </section>

    <section id="chat-section" class="chatbot">
        <div id="chat-container" style="display: contents;">
            <div id="chatbox"></div>
            <div id="userInput-container">
                <input id="userInput" type="text" placeholder="Escribe un mensaje...">
                <button id="sendButton" onclick="sendMessage()"> <span>Enviar</span>
                </button>
            </div>
        </div>
    </section>

    <script>
        window.onload = function () {
            // Agrega un mensaje de bienvenida del chatbot
            addBotMessage("Hola, soy tu chatbot personal");
        }

        function addBotMessage(message) {
            const chatbox = document.getElementById('chatbox');
            const botMessage = '<div class="message-container" ><div class="bot-message">' + message + '</div></div>';
            chatbox.innerHTML += botMessage;
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        async function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value;

            if (message.trim() === "") {
                return;
            }

            const chatbox = document.getElementById('chatbox');
            const userMessage = '<div class="message-container"><div class="user-message">' + message + '</div></div>';
            chatbox.innerHTML += userMessage;

            try {
                const response = await fetch('/index', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        // 'X-CSRFToken': getCookie('csrftoken')  // Asegúrate de tener una función para obtener la cookie CSRF
                    },
                    body: 'message=' + encodeURIComponent(message)
                });

                const botMessage = await response.text();
                const botMessageDiv = '<div class="message-container"><div class="bot-message">' + botMessage + '</div></div>';
                chatbox.innerHTML += botMessageDiv;
                chatbox.scrollTop = chatbox.scrollHeight;
            } catch (error) {
                console.error('Error al enviar mensaje:', error);
            }

            userInput.value = "";
        }
    </script>


</body>

</html>